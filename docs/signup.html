<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Basic responsive form styling */
    .signup-container {
      max-width: 400px;
      margin: 40px auto;
      padding: 2em;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .signup-container label {
      display: block;
      margin-bottom: 0.5em;
      font-weight: 600;
    }
    .signup-container select, .signup-container input, .signup-container button {
      width: 100%;
      padding: 0.5em;
      margin-bottom: 1.5em;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .signup-container button {
      background: #3b82f6;
      color: #fff;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      .signup-container { padding: 1em; }
    }
  </style>
</head>
<body>
  <div class="signup-container">
    <h2 id="formTitle">Sign Up</h2>
    <form id="signUpForm">
      <label for="signUpName">Username</label>
      <input id="signUpName" name="signUpName" type="text" required>
      <label for="signUpPassword">Password</label>
      <input id="signUpPassword" name="signUpPassword" type="password" required>
      <label for="signUpRole">Role</label>
      <select id="signUpRole" name="signUpRole" required>
        <option value="">Select Role</option>
        <option value="student">Student</option>
        <option value="teacher">Teacher</option>
      </select>
      <label for="signUpSchool">School</label>
      <select id="signUpSchool" name="signUpSchool" required>
        <option value="">Select School</option>
      </select>
      <label for="signUpGrade">Grade</label>
      <select id="signUpGrade" name="signUpGrade" required>
        <option value="">Select Grade</option>
      </select>
      <button type="submit">Sign Up</button>
    </form>
    <p class="text-center mt-4">
      <a href="../index.html" style="color:#3b82f6;">Back to Login</a>
    </p>
    <div id="formMessage" style="color:#b91c1c;margin-top:0.5em;display:none;"></div>
  </div>
  <script>
    // Populate school and grade dropdowns
    fetch('data/schools.json')
      .then(res => res.json())
      .then(schools => {
        const schoolSelect = document.getElementById('signUpSchool');
        schools.forEach(school => {
          const opt = document.createElement('option');
          opt.value = school.id;
          opt.textContent = school.name;
          schoolSelect.appendChild(opt);
        });
      });
    function populateGrades(selectId) {
      var gradeSelect = document.getElementById(selectId);
      for (var i = 1; i <= 12; i++) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.textContent = 'Grade ' + i;
        gradeSelect.appendChild(opt);
      }
    }
    populateGrades('signUpGrade');

    const signUpForm = document.getElementById('signUpForm');
    const formMessage = document.getElementById('formMessage');

    // Sign up logic
    signUpForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('signUpName').value.trim();
      const password = document.getElementById('signUpPassword').value;
      const role = document.getElementById('signUpRole').value;
      const schoolId = document.getElementById('signUpSchool').value;
      const grade = document.getElementById('signUpGrade').value;
      if (!name || !password || !role || !schoolId || !grade) {
        formMessage.textContent = 'Please fill in all fields.';
        formMessage.style.color = '#b91c1c';
        formMessage.style.display = '';
        return;
      }
      let users = JSON.parse(localStorage.getItem('users') || '{}');
      if (users[name]) {
        formMessage.textContent = 'Username already exists. Please choose another.';
        formMessage.style.color = '#b91c1c';
        formMessage.style.display = '';
        return;
      }
      const uid = 'uid-' + Math.random().toString(36).slice(2,10);
      users[name] = { password, uid, role, schoolId, grade };
      localStorage.setItem('users', JSON.stringify(users));
      formMessage.textContent = 'Sign up successful! Redirecting...';
      formMessage.style.color = '#16a34a';
      formMessage.style.display = '';
      const userProfile = { uid, name, role, schoolId, grade };
      localStorage.setItem('userProfile', JSON.stringify(userProfile));
      setTimeout(() => {
        window.location.href = '../index.html';
      }, 800);
    });
  </script>
</body>
</html>
